databaseChangeLog:
  - changeSet:
      id: 002-create-feature-usage-table
      author: EugeneTereshchenko
      changes:
        - createTable:
            tableName: feature_usage
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: feature_name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: category
                  type: VARCHAR(50)
              - column:
                  name: timestamp
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: duration_seconds
                  type: INTEGER
              - column:
                  name: session_id
                  type: VARCHAR(100)
              - column:
                  name: device_type
                  type: VARCHAR(50)
              - column:
                  name: ip_address
                  type: VARCHAR(45)
        - addForeignKeyConstraint:
            baseTableName: feature_usage
            baseColumnNames: user_id
            referencedTableName: user
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_feature_usage_user

  - changeSet:
      id: 003-create-feature-ratings-table
      author: EugeneTereschenko
      changes:
        - createTable:
            tableName: feature_ratings
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: feature_name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: rating
                  type: INTEGER
                  constraints:
                    nullable: false
              - column:
                  name: feedback
                  type: TEXT
              - column:
                  name: created_at
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: feature_ratings
            baseColumnNames: user_id
            referencedTableName: user
            referencedColumnNames: id
            onDelete: CASCADE
            constraintName: fk_feature_ratings_user
        - addUniqueConstraint:
            tableName: feature_ratings
            columnNames: user_id, feature_name
            constraintName: uq_feature_ratings_user_feature
        - sql:
            sql: ALTER TABLE feature_ratings ADD CONSTRAINT chk_feature_ratings_rating CHECK (rating BETWEEN 1 AND 5);

  - changeSet:
      id: 004-create-feature-usage-indexes
      author: EugeneTereschenko
      changes:
        - createIndex:
            tableName: feature_usage
            indexName: idx_feature_usage_user_id
            columns:
              - column:
                  name: user_id
        - createIndex:
            tableName: feature_usage
            indexName: idx_feature_usage_feature_name
            columns:
              - column:
                  name: feature_name
        - createIndex:
            tableName: feature_usage
            indexName: idx_feature_usage_timestamp
            columns:
              - column:
                  name: timestamp
                  descending: true
        - createIndex:
            tableName: feature_usage
            indexName: idx_feature_usage_category
            columns:
              - column:
                  name: category
        - createIndex:
            tableName: feature_usage
            indexName: idx_feature_usage_session_id
            columns:
              - column:
                  name: session_id

  - changeSet:
      id: 005-create-feature-ratings-indexes
      author: EugeneTereshchenko
      changes:
        - createIndex:
            tableName: feature_ratings
            indexName: idx_feature_ratings_feature_name
            columns:
              - column:
                  name: feature_name
        - createIndex:
            tableName: feature_ratings
            indexName: idx_feature_ratings_user_id
            columns:
              - column:
                  name: user_id
