<div class="container mt-4">
  <!-- Header -->
  <div class="card shadow-sm mb-4">
    <div class="card-body bg-gradient text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <h2 class="display-6 mb-2">
        <i class="bi bi-clock-history me-2"></i>User Activity Timeline
      </h2>
      <p class="mb-0 opacity-75">Track all user activities and system events in real-time</p>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Filter by Type</label>
          <select class="form-select" [(ngModel)]="selectedType" (change)="filterByType()">
            <option value="all">All Types</option>
            <option value="login">Login</option>
            <option value="logout">Logout</option>
            <option value="update">Update</option>
            <option value="create">Create</option>
            <option value="delete">Delete</option>
            <option value="view">View</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Start Date</label>
          <input type="date" class="form-control" [(ngModel)]="startDate" (change)="filterByDateRange()">
        </div>
        <div class="col-md-4">
          <label class="form-label">End Date</label>
          <input type="date" class="form-control" [(ngModel)]="endDate" (change)="filterByDateRange()">
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-12">
          <button class="btn btn-outline-secondary btn-sm me-2" (click)="clearFilters()">
            <i class="bi bi-x-circle me-1"></i>Clear Filters
          </button>
          <button class="btn btn-outline-primary btn-sm" (click)="refreshData()">
            <i class="bi bi-arrow-clockwise me-1"></i>Refresh
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Timeline -->
  <div class="card shadow-sm">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="bi bi-list-ul me-2 text-primary"></i>Activity Log
      </h5>
      <div>
        <span class="badge bg-primary me-2">{{ activities.length }} Activities</span>
        <button class="btn btn-sm btn-outline-danger" (click)="clearAllActivities()" *ngIf="activities.length > 0">
          <i class="bi bi-trash me-1"></i>Clear All
        </button>
      </div>
    </div>
    <div class="card-body p-0">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted">Loading activities...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="errorMessage && !isLoading" class="alert alert-danger m-3" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>{{ errorMessage }}
      </div>

      <!-- Timeline Items -->
      <div class="timeline-container" *ngIf="!isLoading && !errorMessage">
        <ul class="list-group list-group-flush">
          <li *ngFor="let activity of activities; let i = index" 
              class="list-group-item border-start border-4"
              [ngClass]="{
                'border-primary': activity.type === 'login',
                'border-success': activity.type === 'create',
                'border-warning': activity.type === 'update',
                'border-danger': activity.type === 'delete',
                'border-secondary': activity.type === 'logout',
                'border-info': activity.type === 'view',
                'bg-light': i % 2 === 0
              }">
            <div class="d-flex justify-content-between align-items-start">
              <div class="flex-grow-1">
                <div class="d-flex align-items-center mb-2">
                  <!-- Icon based on activity type -->
                  <span class="badge rounded-circle p-2 me-3"
                        [ngClass]="{
                          'bg-primary': activity.type === 'login',
                          'bg-success': activity.type === 'create',
                          'bg-warning': activity.type === 'update',
                          'bg-danger': activity.type === 'delete',
                          'bg-secondary': activity.type === 'logout',
                          'bg-info': activity.type === 'view'
                        }">
                    <i [ngClass]="iconClass(activity.type)"></i>
                  </span>
                  <div>
                    <strong class="d-block">{{ activity.description }}</strong>
                    <small class="text-muted">
                      <i class="bi bi-clock me-1"></i>{{ activity.timestamp | date:'medium' }}
                      <span class="mx-2">•</span>
                      <i class="bi bi-person me-1"></i>{{ activity.username || 'System' }}
                      <span class="mx-2" *ngIf="activity.ipAddress">•</span>
                      <i class="bi bi-geo-alt me-1" *ngIf="activity.ipAddress"></i>
                      <span *ngIf="activity.ipAddress">{{ activity.ipAddress }}</span>
                    </small>
                  </div>
                </div>
              </div>
              <div class="ms-3 d-flex align-items-center">
                <span [ngClass]="getBadgeClass(activity.type)" class="me-2 text-capitalize">
                  {{ activity.type }}
                </span>
                <button class="btn btn-sm btn-outline-danger" 
                        (click)="deleteActivity(activity.id!)" 
                        *ngIf="activity.id"
                        title="Delete activity">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </li>
        </ul>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && !errorMessage && (!activities || activities.length === 0)" class="text-center py-5">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <h5 class="text-muted mt-3">No Activities Found</h5>
        <p class="text-muted">There are no activities to display at this time.</p>
      </div>
    </div>
    
    <!-- Pagination Footer -->
    <div class="card-footer bg-light" *ngIf="!isLoading && activities && activities.length > 0">
      <div class="d-flex justify-content-between align-items-center">
        <small class="text-muted">Showing {{ activities.length }} activities</small>
      </div>
    </div>
  </div>

  <!-- Stats Summary -->
  <div class="row g-4 mt-4">
    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <i class="bi bi-box-arrow-in-right display-4 text-primary"></i>
          <h4 class="mt-2">{{ getCountByType('login') }}</h4>
          <p class="text-muted mb-0">Logins</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <i class="bi bi-plus-circle display-4 text-success"></i>
          <h4 class="mt-2">{{ getCountByType('create') }}</h4>
          <p class="text-muted mb-0">Created</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <i class="bi bi-pencil-square display-4 text-warning"></i>
          <h4 class="mt-2">{{ getCountByType('update') }}</h4>
          <p class="text-muted mb-0">Updated</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <i class="bi bi-trash display-4 text-danger"></i>
          <h4 class="mt-2">{{ getCountByType('delete') }}</h4>
          <p class="text-muted mb-0">Deleted</p>
        </div>
      </div>
    </div>
  </div>
</div>